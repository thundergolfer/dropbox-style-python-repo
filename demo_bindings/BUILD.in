# TODO(Jonathon): Benjamin P from Dropbox says the exe and runfiles can be copied directly to most Linux
#                 machines, but how is that actually done at Dropbox? See: # https://youtu.be/BnYUn7slfgk?t=862
#                 I tried using Bazel's zipper but it ignores the runfiles. Do they have a small bit of custom Starlark to
#                 to pkg up things?
dbx_py_binary(
    name = "ctypes_test",
    autogen_deps = False,
    main = "ctypes_test.py",
    srcs = [
        "ctypes_test.py"
    ],
    data = [
        ":libcmult.so",
    ],
    deps = [
        "@dbx_build_tools//dropbox:runfiles",
    ]
)

dbx_cffi_module(
    name = "cffi_example",
    module_name = "cffi_example",
    cdef = ":cmult.h",
    source = ":cff_c_header_source.c",
    libraries = ["cmult"],
    #extra_link_args=["-Wl,-rpath,."]
)

#dbx_py_binary(
#    name = "cython_test",
#    main = "cython_test.py",
#)

cc_binary(
    name = "libcmult.so",
    linkstatic=True, 
    linkshared=True,
    srcs = [
        "cmult.c",
        "cmult.h",
    ],
)