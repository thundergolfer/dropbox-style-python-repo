# @generated: This file was generated by bzl. Do not modify!
# Argument overrides and custom targets should be specified in BUILD.in.

load("@dbx_build_tools//build_tools/py:py.bzl", "dbx_py_binary", "dbx_py_pytest_test")

# TODO(Jonathon): Benjamin P from Dropbox says the exe and runfiles can be copied directly to most Linux
#                 machines, but how is that actually done at Dropbox? See: # https://youtu.be/BnYUn7slfgk?t=862
#                 I tried using Bazel's zipper but it ignores the runfiles. Do they have a small bit of custom Starlark to
#                 to pkg up things?
dbx_py_binary(
    name = "ctypes",
    srcs = [
        "ctypes_test.py",
    ],
    # TODO(Jonathon): autogen shouldn't need to be 'False', given only a dependency on '@dbx_build_tools//dropbox:runfiles'.
    # The error I get if I try autogen is: 'AssertionError: Unable to locate modules {'dropbox.runfiles'} (imported by python/demo_bindings/ctypes_test.py) in any library target (NOTE: bin and test targets are ignored)'
    # Should file Github Issue.
    autogen_deps = False,
    data = [
        ":libcmult.so",
    ],
    main = "ctypes_test.py",
    deps = [
        "@dbx_build_tools//dropbox:runfiles",
    ],
)

# The *_binary target is mostly redundant, but this way I'm exercising both rule types.
dbx_py_pytest_test(
    name = "ctypes_test",
    srcs = ["ctypes_test.py"],
    autogen_deps = False,
    data = [
        ":libcmult.so",
    ],
    python2_compatible = False,
    deps = [
        "@dbx_build_tools//dropbox:runfiles",
    ],
)

# Mostly used https://github.com/bazelbuild/bazel/issues/1475 to figure out how get a Bazel target
# that can be dropped into the dbx_py_binary.data list.
cc_binary(
    name = "libcmult.so",
    srcs = [
        "cmult.c",
        "cmult.h",
    ],
    linkshared = True,
    linkstatic = True,
)
